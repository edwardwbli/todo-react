<!DOCTYPE html>
<html>
<head>
  <title>ToDo</title>
  <script src="https://cdn.rawgit.com/amark/gun/master/gun.js"></script>
  <script src="https://unpkg.com/react@15.3.2/dist/react.js"></script>
  <script src="https://unpkg.com/react-dom@15.3.2/dist/react-dom.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.22.1/es6-shim.min.js"></script>
  <style media="screen" type="text/css">
    .todocontent, .inprogresscontent {
      float: left;
      position: relative;
      left: 20%;
      margin-left: 10px;
    }
    h1 {
      margin-left: 20%;
    }
    li {
      color: red;
      font-weight: bolder;
    }
  </style>
</head>
<body>
  <div class="todocontent">
    <h1>Todos</h1>

    <div id="todo"></div>
  </div>

  <div class="inprogresscontent">
    <h1>In progress</h1>
    <div id="inprogress"></div>
  </div>


  <script>
   "use strict";
   var gun = Gun();
   var todo = gun.get('todo');

   var todoElem = React.createClass({
    getInitialState(){ return {todoitems: {}} },
    componentDidMount(){
      var todocomp = this;
      var items = {};
      todo.map(function(value,id) {
         console.log("value: " + value + " id:" + id);
        let obj = {};
        obj[id] = value;
        console.log(obj)
        items = Object.assign({}, items, obj);
        console.log(items);
        todocomp.setState({todoitems: items});
      });

     console.log(this.state.todoitems);

    },
    onSubmit(e){
      e.preventDefault();
      todo.path(Gun.text.random()).put(this.refs.todovalue.value);
      console.log('adding', this.refs.todovalue.value);
      this.refs.todovalue.value = "";
    },
    render(){
      let that = this;
      let items = Object.keys(this.state.todoitems).map(function(i) {
        /*TODO add span field to delete item from Gundb*/
        React.createElement("li", {key: i}, that.state.todoitems[i])
        }
      );
      return React.createElement("form", {onSubmit: this.onSubmit},
        React.createElement("input", {ref: "todovalue"}),
        React.createElement("input", {type:'submit',value:'add'}),
        React.createElement("ul", {}, items)
      );
    }
   });

   ReactDOM.render(React.createElement(todoElem, {}),
     document.getElementById('todo'));

     var inprogress = gun.get('inprogress');

     var inprogressElem = React.createClass({
      getInitialState(){ return {items: {}} },
      componentDidMount(){
        inprogress.map(function(value,id){
          let items = Object.assign({}, this.state.items, {id: value});
          this.setState({items});
        });
      },
      onSubmit(e){
        e.preventDefault();
        inprogress.path(Gun.text.random()).put(this.refs.inprvalue.value);
        console.log('adding', this.refs.inprvalue.value);
      },
      render(){
        let items = Object.keys(this.state.items).map( function(i) {
          React.createElement("li", {key: i}, this.state.items[i])
          }
        );
        return React.createElement("form", {onSubmit: this.onSubmit.bind(this)},
          React.createElement("input", {ref:"inprvalue"}),
          React.createElement("input", {type:'submit',value:'add'}),
          React.createElement("ul", {}, items)
        );
      }
     });

     ReactDOM.render(React.createElement(inprogressElem, {}),
       document.getElementById('inprogress'));
  </script>
</body>
</html>
